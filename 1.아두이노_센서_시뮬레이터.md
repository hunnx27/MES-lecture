// ì•„ë‘ì´ë…¸ ì½”ë“œ
// Arduino ì„¼ì„œ ì‹œë®¬ë ˆì´í„°
#include <ESP8266WiFi.h>
#include <PubSubClient.h>
#include <ArduinoJson.h>

// WiFi ì„¤ì •
const char* ssid = "your_wifi_ssid";
const char* password = "your_wifi_password";

// MQTT ì„¤ì •
const char* mqtt_server = "192.168.1.100";  // MES ì„œë²„ IP
const int mqtt_port = 1883;
const char* mqtt_topic = "factory/sensor/data";

WiFiClient espClient;
PubSubClient client(espClient);

// ì„¼ì„œ í•€ ì„¤ì •
#define TEMP_SENSOR A0      // ì˜¨ë„ ì„¼ì„œ
#define PRESSURE_SENSOR A1  // ì••ë ¥ ì„¼ì„œ
#define VIBRATION_SENSOR A2 // ì§„ë™ ì„¼ì„œ
#define SPEED_SENSOR 2      // ì†ë„ ì„¼ì„œ (ë””ì§€í„¸)

void setup() {
  Serial.begin(115200);
  
  // WiFi ì—°ê²°
  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nâœ… WiFi ì—°ê²°ë¨");
  
  // MQTT ì—°ê²°
  client.setServer(mqtt_server, mqtt_port);
  reconnect();
  
  // ì„¼ì„œ í•€ ì„¤ì •
  pinMode(TEMP_SENSOR, INPUT);
  pinMode(PRESSURE_SENSOR, INPUT);
  pinMode(VIBRATION_SENSOR, INPUT);
  pinMode(SPEED_SENSOR, INPUT);
}

void loop() {
  if (!client.connected()) {
    reconnect();
  }
  client.loop();
  
  // ì„¼ì„œ ë°ì´í„° ì½ê¸°
  float temperature = readTemperature();
  float pressure = readPressure();
  float vibration = readVibration();
  int speed = readSpeed();
  
  // JSON ìƒì„±
  StaticJsonDocument<200> doc;
  doc["equipment_id"] = "EQ-001";
  doc["timestamp"] = millis();
  doc["temperature"] = temperature;
  doc["pressure"] = pressure;
  doc["vibration"] = vibration;
  doc["speed"] = speed;
  
  char jsonBuffer[200];
  serializeJson(doc, jsonBuffer);
  
  // MQTT ì „ì†¡
  if (client.publish(mqtt_topic, jsonBuffer)) {
    Serial.println("ğŸ“Š ë°ì´í„° ì „ì†¡: " + String(jsonBuffer));
  } else {
    Serial.println("âŒ ì „ì†¡ ì‹¤íŒ¨");
  }
  
  delay(1000);  // 1ì´ˆë§ˆë‹¤ ì „ì†¡
}

// ì˜¨ë„ ì„¼ì„œ ì½ê¸° (ì˜ˆ: LM35)
float readTemperature() {
  int rawValue = analogRead(TEMP_SENSOR);
  float voltage = rawValue * (5.0 / 1023.0);
  float temperature = voltage * 100.0;  // LM35: 10mV/Â°C
  return temperature;
}

// ì••ë ¥ ì„¼ì„œ ì½ê¸°
float readPressure() {
  int rawValue = analogRead(PRESSURE_SENSOR);
  // ì„¼ì„œ ì‚¬ì–‘ì— ë§ê²Œ ë³€í™˜ (ì˜ˆ: 0-1023 â†’ 0-100 kPa)
  float pressure = map(rawValue, 0, 1023, 95, 105);
  return pressure;
}

// ì§„ë™ ì„¼ì„œ ì½ê¸°
float readVibration() {
  int rawValue = analogRead(VIBRATION_SENSOR);
  float vibration = rawValue * (3.0 / 1023.0);  // 0-3V
  return vibration;
}

// ì†ë„ ì„¼ì„œ ì½ê¸° (í™€ì„¼ì„œ/ì—”ì½”ë”)
int readSpeed() {
  // ì‹¤ì œë¡œëŠ” ì¸í„°ëŸ½íŠ¸ë¡œ RPM ê³„ì‚°
  // ì—¬ê¸°ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜
  return random(950, 1000);
}

void reconnect() {
  while (!client.connected()) {
    Serial.print("MQTT ì—°ê²° ì¤‘...");
    if (client.connect("ArduinoClient")) {
      Serial.println("âœ… ì—°ê²°ë¨");
    } else {
      Serial.print("âŒ ì‹¤íŒ¨, rc=");
      Serial.println(client.state());
      delay(5000);
    }
  }
}
```

---

## ğŸ“ **êµìœ¡ ê³¼ì •ì— ì•„ë‘ì´ë…¸ ì¶”ê°€ ì‹œë‚˜ë¦¬ì˜¤**

### Week 3-4: ê¸°ì´ˆ (Python ì‹œë®¬ë ˆì´í„°)
- ë¹ ë¥¸ í”„ë¡œí† íƒ€ì´í•‘
- ì•Œê³ ë¦¬ì¦˜ ì´í•´

### Week 10-11: ì‹¬í™” (ì•„ë‘ì´ë…¸ ì‹¤ìŠµ)
- ì‹¤ì œ ì„¼ì„œ ì—°ê²°
- í•˜ë“œì›¨ì–´ ì²´í—˜

---

## ğŸ› ï¸ **ì‹¤ìŠµ í‚¤íŠ¸ êµ¬ì„±**

### ê¸°ë³¸ í‚¤íŠ¸ (í•™ìƒ 1ëª…ë‹¹)
```
1. ESP32 ê°œë°œë³´ë“œ        (â‚©10,000)
2. ì˜¨ë„ì„¼ì„œ (DS18B20)    (â‚©3,000)
3. ì§„ë™ì„¼ì„œ (SW-420)     (â‚©2,000)
4. ì••ë ¥ì„¼ì„œ (BMP280)     (â‚©5,000)
5. í™€ì„¼ì„œ (ì†ë„ìš©)        (â‚©2,000)
6. ë¸Œë ˆë“œë³´ë“œ + ì í¼ì„    (â‚©5,000)
-----------------------------------
   ì´ ì•½ â‚©27,000
```

### ì‹¤ìŠµ ìˆœì„œ
```
1ë‹¨ê³„: LED ê¹œë¹¡ì´ê¸° (Hello World)
2ë‹¨ê³„: ì„¼ì„œ 1ê°œ ì½ê¸° (ì˜¨ë„)
3ë‹¨ê³„: ì‹œë¦¬ì–¼ ëª¨ë‹ˆí„°ë¡œ í™•ì¸
4ë‹¨ê³„: WiFi ì—°ê²°
5ë‹¨ê³„: MQTT ì „ì†¡
6ë‹¨ê³„: MES ì‹œìŠ¤í…œê³¼ ì—°ë™
```

---

## ğŸ’¡ **êµìœ¡ íš¨ê³¼**

### Python ì‹œë®¬ë ˆì´í„°
- ë¹ ë¥¸ ê°œë°œ âœ…
- ì•Œê³ ë¦¬ì¦˜ í…ŒìŠ¤íŠ¸ âœ…
- ì†Œí”„íŠ¸ì›¨ì–´ ì¤‘ì‹¬ âœ…

### ì•„ë‘ì´ë…¸ ì‹¤ìŠµ
- ì‹¤ì œ ì„¼ì„œ ì²´í—˜ âœ…
- í•˜ë“œì›¨ì–´ ì´í•´ âœ…
- ì„ë² ë””ë“œ ê²½í—˜ âœ…
- **ì·¨ì—… í¬íŠ¸í´ë¦¬ì˜¤ì— ê°•ë ¥!** âœ…âœ…âœ…

---

## ğŸ­ **ì‹¤ì œ ê³µì¥ì—ì„œëŠ”?**

### ì†Œê·œëª¨
- ì•„ë‘ì´ë…¸/ESP32
- ë¼ì¦ˆë² ë¦¬íŒŒì´

### ì¤‘ëŒ€ê·œëª¨
- **PLC** (Siemens, Mitsubishi, Allen-Bradley)
- ì‚°ì—…ìš© ê²Œì´íŠ¸ì›¨ì´

### ëŒ€ê·œëª¨
- SCADA ì‹œìŠ¤í…œ
- Edge Computing

**ëª¨ë‘ MQTTë‚˜ OPC-UAë¡œ í†µì‹ !**

---

## ğŸ¯ **ì¶”ì²œ êµìœ¡ ë°©ì‹**

### Option 1: Pythonë§Œ (ë¹ ë¥¸ ì§„í–‰)
```
âœ… ê°„ë‹¨, ë¹ ë¦„
âœ… ì•Œê³ ë¦¬ì¦˜ì— ì§‘ì¤‘
âŒ í•˜ë“œì›¨ì–´ ê²½í—˜ ì—†ìŒ
```

### Option 2: Python + ì•„ë‘ì´ë…¸ (ì¶”ì²œ!)
```
âœ… Pythonìœ¼ë¡œ í”„ë¡œí† íƒ€ì…
âœ… Week 10ì— ì•„ë‘ì´ë…¸ë¡œ ì‹¤ì œ êµ¬í˜„
âœ… í•˜ë“œì›¨ì–´ + ì†Œí”„íŠ¸ì›¨ì–´ ëª¨ë‘ ê²½í—˜
âœ… í¬íŠ¸í´ë¦¬ì˜¤ ì„íŒ©íŠ¸ â¬†ï¸
```

### Option 3: ì•„ë‘ì´ë…¸ë§Œ
```
âœ… ì‹¤ì „ ëŠë‚Œ
âŒ ì‹œê°„ ì˜¤ë˜ ê±¸ë¦¼
âŒ ë””ë²„ê¹… ì–´ë ¤ì›€